总体设计                                                                                    
                                                                                              
  - 分层解耦                                                                                  
      - 任务接口层：按任务拆分接口（检测/分割/姿态），保证里氏替换。                          
      - 模型适配层（策略）：把不同家族（YOLO/DETR/Mask/HRNet）的前后处理封装进适配器，遵循开闭
  原则（新增类+注册即可）。                                                                   
      - 推理后端层：ONNX/TensorRT/OpenVINO 等后端实现，VideoAnalyzer 只依赖抽象（依赖倒置）。 
      - 管道/调度：VideoAnalyzer 只做编排（队列、线程、回调、推流），不关心模型细节。         
                                                                                              
  关键抽象                                                                                    
                                                                                              
  - 任务接口（稳定契约）                                                                      
      - IDetectionModel: infer(const cv::Mat&) -> vector<Detection>（你已有 DetectionResult 可
  复用）                                                                                      
      - ISegmentationModel, IPoseModel: 返回各自的标准结果（SegmentationResult / Pose）       
  - 前/后处理策略（可组合）                                                                   
      - IPreprocessor: 如 LetterboxPreproc, ResizePreproc, NormalizePreproc                   
      - IPostprocessor: 如 YoloDetectPost, DetrPost, MaskPost, PosePost                       
  - 推理后端                                                                                  
      - IInferenceBackend: 加载模型和执行 run（屏蔽 ORT/TRT/OpenVINO 差异）                   
  - 模型注册/工厂                                                                             
      - ModelRegistry: 根据 ModelDesc{task, family, framework, path} 创建模型实例。新增模型只 
  需新增 Adapter 并注册创建器即可（OCP）。                                                    
      - 示例：video-analyzer/include/analysis/ModelRegistry.h:1, video-analyzer/src/analysis/ 
  ModelRegistry.cpp:1                                                                         
                                                                                                                                         
                                                                                              
  如何新增其他任务/模型                                                                       
                                                                                              
  - 实例分割（Segmentation）                                                                  
      - 新增 ISegmentationModel 接口实现（如 YoloSegAdapter, MaskRCNNSegAdapter）。           
      - 解析输出掩码或轮廓，返回 SegmentationResult（你已有结构，可复用）。                   
      - 在 ModelRegistry 注册 registerSegmenter("yolov8-seg", creator)（可扩展出分割注册表，方
  式与检测一致）。                                                                            
      - VideoAnalyzer 的 pipeline 根据任务选择对应模型；对分割的 mask 已在 processRequest() 中
  叠加了彩色结果。                                                                            
  - 姿态（Pose）                                                                              
      - 定义 IPoseModel 与 Pose 数据结构（关键点、置信度、连接）。                            
      - Adapter：PoseHRNetAdapter/RTMPoseAdapter 等，注册成 registerPose("hrnet", creator)。  
  - DETR / Transformer 检测                                                                   
      - 新增 DetrDetectAdapter，解析其输出 layout（通常 logits + boxes），做软/硬 NMS。       
      - 注册 registerDetector("detr", creator)，family="detr" 时自动选择。                    
                                                                                              
  接口与设计模式映射                                                                          
                                                                                              
  - 策略（Strategy）：前/后处理策略对象、不同模型适配器。                                     
  - 工厂/注册表（Factory/Registry）：ModelRegistry 基于 ModelDesc 创建实例。                  
  - 适配器（Adapter）：把 YOLO、DETR 等对齐到统一的任务接口。                                 
  - 观察者（Observer）：分析结果广播给信令/WebRTC/存储。                                      
  - 依赖倒置（DIP）：VideoAnalyzer 仅依赖接口和注册表（不依赖具体实现）。                     
  - 开闭（OCP）：扩展即新增 Adapter + 注册；核心 VideoAnalyzer 不改。                         
                                                                                              
  并发与资源                                                                                  
  保障稳定。
  - 后端预热/热切换：模型切换时，先暂停队列，装载新模型（可加 std::shared_mutex 写锁保护），再
  恢复。
  - 结果渲染：后端绘制（如你所需），前端仅显示；特殊可选叠加（开关控制）。

  配置与 API

  - 统一模型描述（建议）：
      - task: detect|segment|pose
      - family: yolov12|detr|maskrcnn|hrnet
      - framework: onnx|tensorrt|openvino
      - path: 模型路径
      - preprocess: letterbox: true|false, input_size, normalize, color:BGR/RGB
      - postprocess: conf_thres, iou_thres, output_layout: NC|CN
  - 运行时 API：加载/卸载模型、切换任务、获取统计、热切换源。

  改造路线（建议步骤）

  1. 接口抽取与注册表（已完成基础骨架）：ModelRegistry + YoloDetectAdapter。
  2. VideoAnalyzer 初始化改用注册表（已接入，保持回退到 ONNX/简单模型）。
  3. 拆分 ONNXModel 到单独适配器（下一步可做），避免 VideoAnalyzer.h 聚合实现。
  4. 抽象 ISegmentationModel / IPoseModel 接口与注册表；先对接一个分割/姿态模型。
  5. 抽出 IInferenceBackend（ONNX/TensorRT/OpenVINO），逐步让 Adapter 依赖它而非直接 ORT。    
  6. 完善配置结构与 AnalysisAPI，使前端可动态切换模型与任务。
  7. 单测/基准：预+后处理、IOU/NMS、吞吐与内存统计。